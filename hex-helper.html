<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hex Helper</title>
  <style>
:root {
   --bg: #0b0f14;
   --panel: #121a22;
   --panel2: #0f1620;
   --text: #e9f1ff;
   --muted: #9fb3c8;
   --line: #233243;
   --accent: #59a6ff;
   --danger: #ff5d5d;
   --ok: #6dff9b;
   --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
   --sans: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

body {
   margin: 0;
   background: linear-gradient(180deg, #070a0f 0%, #0b0f14 100%);
   color: var(--text);
   font-family: var(--sans);
   min-height: 100vh;
   padding: 24px;
}

.wrap {
   max-width: 1100px;
   margin: 0 auto;
   display: grid;
   gap: 16px;
}

.title {
   background: rgba(18, 26, 34, .7);
   border: 1px solid var(--line);
   border-radius: 18px;
   padding: 18px 18px;
   box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
}

.title h1 {
   margin: 0;
   font-size: 20px;
   letter-spacing: .2px;
}

.title p {
   margin: 6px 0 0 0;
   color: var(--muted);
   font-size: 14px;
   line-height: 1.4;
}

.grid {
   display: grid;
   grid-template-columns: 1.2fr .8fr;
   gap: 16px;
}

@media (max-width: 980px) {
   .grid {
      grid-template-columns: 1fr;
   }
}

.card {
   background: rgba(18, 26, 34, .65);
   border: 1px solid var(--line);
   border-radius: 18px;
   padding: 16px;
   box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
}

.row {
   display: flex;
   gap: 10px;
   flex-wrap: wrap;
   align-items: center;
}

label {
   font-size: 13px;
   color: var(--muted);
}

select,
textarea,
input {
   background: var(--panel2);
   border: 1px solid var(--line);
   color: var(--text);
   border-radius: 14px;
   padding: 10px 12px;
   outline: none;
   font-family: var(--sans);
}

select:focus,
textarea:focus,
input:focus {
   border-color: rgba(89, 166, 255, .6);
   box-shadow: 0 0 0 3px rgba(89, 166, 255, .12);
}

textarea {
   width: 100%;
   min-height: 140px;
   resize: vertical;
   font-family: var(--mono);
   font-size: 14px;
   line-height: 1.45;
}

button {
   border: none;
   background: linear-gradient(180deg, #4f9cff 0%, #2e7cff 100%);
   color: #061018;
   padding: 10px 14px;
   border-radius: 14px;
   font-weight: 700;
   cursor: pointer;
   transition: transform .05s ease;
}

button:active {
   transform: scale(.98);
}

.btn2 {
   background: transparent;
   border: 1px solid var(--line);
   color: var(--text);
   font-weight: 600;
}

.pill {
   font-family: var(--mono);
   font-size: 12px;
   color: var(--muted);
   padding: 6px 10px;
   border: 1px solid var(--line);
   border-radius: 999px;
   background: rgba(0, 0, 0, .2);
}

.out {
   font-family: var(--mono);
   font-size: 14px;
   line-height: 1.55;
   white-space: pre-wrap;
   background: rgba(0, 0, 0, .25);
   border: 1px solid var(--line);
   border-radius: 16px;
   padding: 12px;
   min-height: 120px;
}

.hint {
   color: var(--muted);
   font-size: 13px;
   line-height: 1.4;
   margin-top: 10px;
}

table {
   width: 100%;
   border-collapse: collapse;
   font-family: var(--mono);
   font-size: 13px;
   overflow: hidden;
   border-radius: 14px;
}

th,
td {
   border-bottom: 1px solid rgba(35, 50, 67, .6);
   padding: 10px 10px;
   vertical-align: top;
}

th {
   text-align: left;
   color: var(--muted);
   font-weight: 700;
   background: rgba(0, 0, 0, .15);
}

.bad {
   color: var(--danger);
}

.ok {
   color: var(--ok);
}

.footer {
   color: var(--muted);
   font-size: 13px;
   text-align: center;
   padding: 6px 0 2px;
}

.mini {
   font-size: 12px;
   color: var(--muted);
}

.optional-header {
   cursor: pointer;
   font-weight: 700;
   padding: 10px;
   border-radius: 12px;
   background: rgba(0, 0, 0, .25);
   border: 1px solid var(--line);
   user-select: none;
}

.optional-header:hover {
   background: rgba(0, 0, 0, .35);
}

.optional-content {
   max-height: 0;
   overflow: hidden;
   transition: max-height .35s ease;
   margin-top: 10px;
}

.optional-content.open {
   max-height: 500px;
}
  </style>
</head>
<body>
   <div class="wrap">
      <div class="title">
         <h1>ğŸ”¹ Hex Helper ğŸ”¹</h1>
         <p>
            Tool chuyá»ƒn Ä‘á»•i <b>Hex â†” Char â†” Token</b>.  
            CÃ³ há»— trá»£ mÃ£ dáº¡ng <b>F4xx</b>, <b>FDxx</b>.
      </div>
      <div class="grid">
         <div class="card">
            <div class="row">
               <label>âš¡ Chá»n chá»©c nÄƒng:</label>
               <select id="mode">
                  <option value="1">1ï¸âƒ£ Hex â†” Char</option>
                  <option value="2">2ï¸âƒ£ Hex â†’ Token</option>
                  <option value="3">3ï¸âƒ£ Tá»•ng quÃ¡t Hex â†” Char â†” Token</option>
                  <option value="4">4ï¸âƒ£ Báº£ng KÃ½ Tá»± (Tra cá»©u)</option>
               </select>
               <span class="pill" id="status">Ready</span>
            </div>
            <div style="height:12px"></div>
            <label>ğŸ” Nháº­p dá»¯ liá»‡u (hex cÃ³ thá»ƒ cÃ³ hoáº·c khÃ´ng cÃ³ dáº¥u cÃ¡ch):</label>
            <textarea id="input" placeholder="VÃ­ dá»¥:
F4 7B
F47B
               "></textarea>
            <div style="height:12px"></div>
            <div class="row">
               <button id="btnRun">Dá»‹ch</button>
               <button class="btn2" id="btnClear">XoÃ¡</button>
               <button class="btn2" id="btnCopy">Copy káº¿t quáº£</button>
            </div>
            <div class="hint">
               Tip:  
               - Nháº­p hex: <code>F47B</code> hoáº·c <code>F4 7B</code> Ä‘á»u Ä‘Æ°á»£c.  
               - Nháº­p char: vÃ­ dá»¥ <code>áº»</code>, <code>Ã¡</code>, <code>âˆ«</code>.  
               - Token lÃ  báº£ng riÃªng (hex_token).
            </div>
         </div>
         <div class="card">
            <div class="row" style="justify-content:space-between;">
               <div>
                  <div class="mini">ğŸ“Œ Output</div>
                  <div class="mini">Káº¿t quáº£ hiá»ƒn thá»‹ theo mode Ä‘Ã£ chá»n</div>
               </div>
            </div>
            <div style="height:10px"></div>
            <div id="output" class="out">...</div>
         </div>
      </div>
      <div class="card">
         <div class="row" style="justify-content:space-between;">
            <div>
               <div class="mini">ğŸ“œ Báº£ng tra cá»©u</div>
               <div class="mini">Chá»‰ hiá»‡n khi mode = 4</div>
            </div>
         </div>
         <div style="height:10px"></div>
         <div id="tableWrap" style="display:none;">
            <table>
               <thead>
                  <tr>
                     <th style="width:90px;">Hex</th>
                     <th style="width:80px;">Char</th>
                     <th style="width:110px;">Token</th>
                     <th style="width:260px;">CÃ´ng thá»©c 1</th>
                     <th>CÃ´ng thá»©c 2</th>
                  </tr>
               </thead>
               <tbody id="tbody"></tbody>
            </table>
         </div>
         <div id="tableHint" class="hint">
            Mode 4 sáº½ show báº£ng á»Ÿ Ä‘Ã¢y.
         </div>
      </div>
      <div class="card">
         <div class="optional-header" id="optionalToggle">
            <span>â–¶ Optional</span>
         </div>
         <div class="optional-content" id="optionalContent">
            <div class="row" style="justify-content:space-between;">
               <div class="mini">ğŸ•˜ Lá»‹ch sá»­ xem</div>
               <button class="btn2" id="clearHistory">XoÃ¡ lá»‹ch sá»­</button>
            </div>
            <div style="height:10px"></div>
            <div id="historyList" class="out" style="min-height:80px;"></div>
         </div>
      </div>
      <div class="footer">
         <p>ğŸ’¡ Development: Quá»‘c Tháº¯ng â€¢ TikTok: @qtwqa</p>
         <p>ğŸ”¹ HTML: @truongmebackrooms (discord)</p>
      </div>
   </div>

<script>
/* ==============================
   DATA (y nguyÃªn tá»« Python)
   ============================== */

const hex_token = {
  '01':'â–’','02':'@','03':'@','04':'@','05':'@','06':'@','07':'@','08':'@','09':'@','0A':'@','0B':'@','0C':'@','0D':'@','0E':'@','0F':'@',
  '10':'@','11':'@','12':'@','13':'@','14':'@','15':'@','16':'@','17':'@','18':'@','19':'â–¯','1A':'@','1B':'@','1C':'@','1D':'@','1E':'@','1F':'@',
  '20':'ğ’Š','21':'ğ’†','22':'ğœ‹','23':':','24':'$','25':'?','26':'@','27':'@','28':'@','29':'@','2A':'@','2B':'@','2C':',','2D':'x10','2E':'.','2F':'@',
  '30':'0','31':'1','32':'2','33':'3','34':'4','35':'5','36':'6','37':'7','38':'8','39':'9','3A':'ğ€','3B':'ğ','3C':'ğ‚','3D':'ğƒ','3E':'ğ„','3F':'ğ…',
  '40':'ğ‘´','41':'Ans','42':'A','43':'B','44':'C','45':'D','46':'E','47':'F','48':'ğ’™','49':'ğ’š','4A':'PreAns','4B':'z','4C':'ğœƒ','4D':'@','4E':'@','4F':'@',
  '50':'âˆ‘(','51':'âˆ«(','52':'d/dğ’™(','53':'âˆ(','54':'@','55':'@','56':'@','57':'@','58':'Min(','59':'Max(','5A':'Mean(','5B':'Sum(','5C':'@','5D':'@','5E':'@','5F':'@',
  '60':'(','61':'P(','62':'Q(','63':'R(','64':'Not(','65':'Neg(','66':'Conjg(','67':'Arg(','68':'Abs(','69':'Rnd(','6A':'Det(','6B':'Trn(','6C':'sinh(','6D':'cosh(','6E':'tanh(','6F':'sinhâ»Â¹(',
  '70':'coshâ»Â¹(','71':'tanhâ»Â¹(','72':'ğ’†^(','73':'10^(','74':'âˆš(','75':'ln(','76':'Â³âˆš(','77':'sin(','78':'cos(','79':'tan(','7A':'sinâ»Â¹(','7B':'cosâ»Â¹(','7C':'tanâ»Â¹(','7D':'log(','7E':'Pol(','7F':'Rec(',
  '80':'@','81':'@','82':'@','83':'Int(','84':'Intg(','85':'Ref(','86':'Rref(','87':'RanInt#(','88':'GCD(','89':'LCM(','8A':'RndFix(','8B':'@','8C':'@','8D':'@','8E':'@','8F':'ReP(',
  '90':'ImP(','91':'Identity(','92':'UnitV(','93':'Angle(','94':'@','95':'@','96':'@','97':'@','98':'@','99':'@','9A':'@','9B':'@','9C':'@','9D':'@','9E':'@','9F':'@',
  'A0':'or','A1':'xor','A2':'xnor','A3':'and','A4':'@','A5':'=','A6':'+','A7':'-','A8':'Ã—','A9':'Ã·','AA':'Ã·R','AB':'*','AC':'âˆ ','AD':'ğ™‹','AE':'ğ˜¾','AF':'@',
  'B0':'@','B1':'@','B2':'@','B3':'@','B4':'@','B5':'@','B6':'@','B7':'@','B8':'xÌ‚','B9':'Å·','BA':'xÌ‚â‚','BB':'xÌ‚â‚‚','BC':'@','BD':'@','BE':'@','BF':'@',
  'C0':'â€“','C1':'b','C2':'o','C3':'d','C4':'h','C5':'@','C6':'@','C7':'@','C8':'âŒŸ','C9':'^(','CA':'Ë£âˆš(','CB':'@','CC':'@','CD':'@','CE':'@','CF':'@',
  'D0':')','D1':'â–¸t','D2':'â–¸a+bğ’Š','D3':'â–¸râˆ ğœƒ','D4':'â»Â¹','D5':'Â²','D6':'Â³','D7':'%','D8':'!','D9':'Â°','DA':'Ê³','DB':'áµ','DC':'â–«','DD':'ğ„','DE':'ğ','DF':'ğ“',
  'E0':'ğ†','E1':'ğŒ','E2':'ğ¤','E3':'ğ¦','E4':'ğ','E5':'ğ§','E6':'ğ©','E7':'ğŸ','E8':'@','E9':'â–¸Simp','EA':'@','EB':'@','EC':'@','ED':'@','EE':'@','EF':'@',

  // token F4xx
  'F410':'â–’','F411':'â–’','F412':'â–’','F413':'â–’','F414':'â–’','F415':'â–’','F416':'â–’','F417':'â–’','F418':'â–’','F419':'â–’','F41A':'â–’','F41B':'â–’','F41C':'â–’','F41D':'â–’','F41E':'â–’','F41F':'â–’',
  'F420':'â–’','F421':'â–’','F422':'â–’','F423':'â–’','F424':'â–’','F425':'â–’','F426':'â–’','F427':'â–’','F428':'â–’','F429':'â–’','F42A':'â–’','F42B':'â–’','F42C':'â–’','F42D':'â–’','F42E':'â–’','F42F':'â–’',
  'F430':'â–’','F431':'â–’','F432':'â–’','F433':'â–’','F434':'â–’','F435':'â–’','F436':'â–’','F437':'â–’','F438':'â–’','F439':'â–’','F43A':'â–’','F43B':'â–’','F43C':'â–’','F43D':'â–’','F43E':'â–’','F43F':'â–’',
  'F440':'â–’','F441':'â–’','F442':'â–’','F443':'â–’','F444':'â–’','F445':'â–’','F446':'â–’','F447':'â–’','F448':'â–’','F449':'â–’','F44A':'â–’','F44B':'â–’','F44C':'â–’','F44D':'â–’','F44E':'â–’','F44F':'â–’',
  'F450':'â–’','F451':'â–’','F452':'â–’','F453':'â–’','F454':'â–’','F455':'â–’','F456':'â–’','F457':'â–’','F458':'â–’','F459':'â–’','F45A':'â–’','F45B':'â–’','F45C':'â–’','F45D':'â–’','F45E':'â–’','F45F':'â–’',
  'F460':'â–’','F461':'â–’','F462':'â–’','F463':'â–’','F464':'â–’','F465':'â–’','F466':'â–’','F467':'â–’','F468':'â–’','F469':'â–’','F46A':'â–’','F46B':'â–’','F46C':'â–’','F46D':'â–’','F46E':'â–’','F46F':'â–’',
  'F470':'â–’','F471':'â–’','F472':'â–’','F473':'â–’','F474':'â–’','F475':'â–’','F476':'â–’','F477':'â–’','F478':'â–’','F479':'â–’','F47A':'â–’','F47B':'â–’','F47C':'â–’','F47D':'â–’','F47E':'â–’','F47F':'â–’',
  'F480':'â–’','F481':'â–’','F482':'â–’','F483':'â–’','F484':'â–’','F485':'â–’','F486':'â–’','F487':'â–’','F488':'â–’','F489':'â–’','F48A':'â–’','F48B':'â–’','F48C':'â–’','F48D':'â–’','F48E':'â–’','F48F':'â–’',
  'F490':'â–’','F491':'â–’','F492':'â–’','F493':'â–’','F494':'â–’','F495':'â–’',

  'FD20':'an','FD21':'n','FD22':'@', 'FD23':'@', 'FD24':'@', 'F4F4':'â–’'
};

const hex_char = {
  '01':'â–’','02':'â–’','03':'â–’','04':'â–’','05':'â–’','06':'â–’','07':'â–’','08':'â–’','09':'â–’','0A':'â–’','0B':'â–’','0C':'â–’','0D':'â–’','0E':'â–’','0F':'â–’',
  '10':'ğ’™','11':'ğ’š','12':'ğ’›','13':'â€¦','14':'â–²','15':'â–¼','16':'â–¸','17':'â‚‹','18':'$','19':'â—','1A':'&','1B':'ğ‘¡','1C':'á´›','1D':'â‚œ','1E':'â‚•','1F':'â‚…',
  '20':' ','21':'!','22':'"','23':'#','24':'Ã—','25':'%','26':'Ã·','27':"'",'28':'(','29':')','2A':'.','2B':'+','2C':',','2D':'â€”','2E':'.','2F':'/',
  '30':'0','31':'1','32':'2','33':'3','34':'4','35':'5','36':'6','37':'7','38':'8','39':'9','3A':':','3B':';','3C':'<','3D':'=','3E':'>','3F':'?',
  '40':'@','41':'A','42':'B','43':'C','44':'D','45':'E','46':'F','47':'G','48':'H','49':'I','4A':'J','4B':'K','4C':'L','4D':'M','4E':'N','4F':'O',
  '50':'P','51':'Q','52':'R','53':'S','54':'T','55':'U','56':'V','57':'W','58':'X','59':'Y','5A':'Z','5B':'[','5C':'â–«','5D':']','5E':'^','5F':'_',
  '60':'âˆ’','61':'a','62':'b','63':'c','64':'d','65':'e','66':'f','67':'g','68':'h','69':'i','6A':'j','6B':'k','6C':'l','6D':'m','6E':'n','6F':'o',
  '70':'p','71':'q','72':'r','73':'s','74':'t','75':'u','76':'v','77':'w','78':'x','79':'y','7A':'z','7B':'{','7C':'|','7D':'}','7E':'~','7F':'â”œ',

  '80':'ğ’Š','81':'ğ’†','82':'ğ–','83':'ğŸğŸ','84':'âˆ','85':'Â°','86':'Ê³','87':'áµ','88':'âˆ ','89':'xÌ„','8A':'È³','8B':'xÌ‚','8C':'Å·','8D':'â†’','8E':'âˆ','8F':'â‡’',
  '90':'Ã—','91':'ğŸ­ğŸ¬','92':'ğŸğŸâ»','93':'âŒŸ','94':'â‰¤','95':'â‰ ','96':'â‰¥','97':'â‡©','98':'âˆš','99':'âˆ«','9A':'á´€','9B':'Ê™','9C':'á´„','9D':'â‚™','9E':'â–¶','9F':'â—€',
  'A0':'â°','A1':'Â¹','A2':'Â²','A3':'Â³','A4':'â´','A5':'âµ','A6':'â¶','A7':'â·','A8':'â¸','A9':'â¹','AA':'â»Â¹','AB':'Ë£','AC':'ğŸğŸ','AD':'â‚','AE':'â‚','AF':'Â±',
  'B0':'â‚€','B1':'â‚','B2':'â‚‚','B3':'-1','B4':'êœ°','B5':'É´','B6':'á´˜','B7':'\ue0b7','B8':'ğ‘¨','B9':'ğ‘©','BA':'ğ‘ª','BB':'ğ‘«','BC':'ğ‘¬','BD':'ğ‘­','BE':'ğ‘·','BF':'â–·',

  'C0':'âˆ‘','C1':'ğ›¼','C2':'ğ›¾','C3':'ğœ€','C4':'ğœƒ','C5':'ğœ†','C6':'ğœ‡','C7':'ğœ‹','C8':'ğœ','C9':'ğœ™','CA':'â„“','CB':'â„','CC':'â–®','CD':'â–¯','CE':'â‚ƒ','CF':'ï¼¿',

  'D0':'ğŸ','D1':'ğ©','D2':'ğ§','D3':'ğ','D4':'ğ¦','D5':'ğ¤','D6':'ğŒ','D7':'ğ†','D8':'ğ“','D9':'ğ','DA':'ğ„','DB':'ğ¹','DC':'â‚š','DD':'â‚‘','DE':'á´Š','DF':'á´‹',

  'E0':'\ue0e0','E1':'áµ¤','E2':'â‚‰','E3':'â„«','E4':'â‚˜','E5':'Éª','E6':'â‚„','E7':'\ue0e7','E8':'\ue0e8','E9':'âˆŸ','EA':'â†º','EB':'\ue0eb','EC':'â¿','ED':'','EE':'â–’','EF':'â–’',

  // F4xx Vietnamese
  'F410':'áº ','F411':'áº®','F412':'áº°','F413':'áº¶','F414':'áº¤','F415':'áº¦','F416':'áº¨','F417':'áº¬','F418':'áº¼','F419':'áº¸','F41A':'áº¾','F41B':'á»€','F41C':'á»‚','F41D':'á»„','F41E':'á»†','F41F':'á»',
  'F420':'á»’','F421':'á»”','F422':'á»–','F423':'á»˜','F424':'á»¢','F425':'á»š','F426':'á»œ','F427':'á»','F428':'á»Š','F429':'á»','F42A':'á»Œ','F42B':'á»ˆ','F42C':'á»¦','F42D':'Å¨','F42E':'á»¤','F42F':'á»²',
  'F430':'Ã•','F431':'áº¯','F432':'áº±','F433':'áº·','F434':'áº¥','F435':'áº§','F436':'áº©','F437':'áº­','F438':'áº½','F439':'áº¹','F43A':'áº¿','F43B':'á»','F43C':'á»ƒ','F43D':'á»…','F43E':'á»‡','F43F':'á»‘',
  'F440':'á»“','F441':'á»•','F442':'á»—','F443':'á» ','F444':'Æ ','F445':'á»™','F446':'á»','F447':'á»Ÿ','F448':'á»‹','F449':'á»°','F44A':'á»¨','F44B':'á»ª','F44C':'á»¬','F44D':'Æ¡','F44E':'á»›','F44F':'Æ¯',
  'F450':'Ã€','F451':'Ã','F452':'Ã‚','F453':'Ãƒ','F454':'áº¢','F455':'Ä‚','F456':'áº³','F457':'áºµ','F458':'Ãˆ','F459':'Ã‰','F45A':'ÃŠ','F45B':'áºº','F45C':'ÃŒ','F45D':'Ã','F45E':'Ä¨','F45F':'á»³',
  'F460':'Ä','F461':'á»©','F462':'Ã’','F463':'Ã“','F464':'Ã”','F465':'áº¡','F466':'á»·','F467':'á»«','F468':'á»­','F469':'Ã™','F46A':'Ãš','F46B':'á»¹','F46C':'á»µ','F46D':'Ã','F46E':'á»¡','F46F':'Æ°',
  'F470':'Ã ','F471':'Ã¡','F472':'Ã¢','F473':'Ã£','F474':'áº£','F475':'Äƒ','F476':'á»¯','F477':'áº«','F478':'Ã¨','F479':'Ã©','F47A':'Ãª','F47B':'áº»',

  'F47C':'Ã¬','F47D':'Ã­','F47E':'Ä©','F47F':'á»‰','F480':'Ä‘','F481':'á»±','F482':'Ã²','F483':'Ã³','F484':'Ã´','F485':'Ãµ','F486':'á»','F487':'á»','F488':'á»¥','F489':'Ã¹',
  'F48A':'Ãº','F48B':'Å©','F48C':'á»§','F48D':'Ã½','F48E':'á»£','F48F':'á»®','F490':'áº²','F491':'áº´','F492':'áºª','F493':'á»¶','F494':'á»¸','F495':'á»´',

  'FD20':'â–’','FD21':'â–’','FD22':'â–’', 'F4F4':'â–’'
};

const cong_thuc1 = {
  '21':'[Alpha] [x10]','22':'[Shift] [x10]','23':'[Alpha] [âˆ«]','2C':'[Shift] [)]','2D':'[x10]','2E':'[.]',
  '30':'[0]','31':'[1]','32':'[2]','33':'[3]','34':'[4]','35':'[5]','36':'[6]','37':'[7]','38':'[8]','39':'[9]',
  '40':'[Alpha] [M+]','41':'[Ans]','42':'[Alpha] [(-)]','43':"[Alpha] [Â°''']",'44':'[Alpha] [xâ»Â¹]',
  '45':'[Alpha] [sin]','46':'[Alpha] [cos]','47':'[Alpha] [tan]','48':'[x]','49':'[Alpha] [)]','4A':'[Alpha] [Ans]',
  '4B':'[Alpha] [Sâ†”D]','50':'[Shift] [x]','51':'[âˆ«]','52':'[Shift] [âˆ«]','53':'[Alpha] [x]',
  '60':'[(]','68':'[Shift] [(]','69':'[Shift] [0]',
  '6C':'[OPTN] [1] [1]','6D':'[OPTN] [1] [2]','6E':'[OPTN] [1] [3]','6F':'[OPTN] [1] [4]','70':'[OPTN] [1] [5]','71':'[OPTN] [1] [6]',
  '72':'[Shift] [ln]','73':'[Shift] [logâ–ªâ–¯]','74':'[âˆš]','75':'[ln]','76':'[Shift] [âˆš]',
  '77':'[sin]','78':'[cos]','79':'[tan]','7A':'[shift] [sin]','7B':'[shift] [cos]','7C':'[shift] [tan]','7D':'[logâ–ªâ–¯]',
  '7E':'[Shift] [+]','7F':'[Shift] [-]',
  '83':'[Alpha] [+]','84':'[Alpha] [-]','87':'[Alpha] [.]','88':'[Alpha] [Ã—]','89':'[Alpha] [Ã·]',
  'A5':'[Alpha] [Calc]','A6':'[+]','A7':'[-]','A8':'[Ã—]','A9':'[Ã·]','AA':'[Alpha] [Frac]','AD':'[Shift] [Ã—]','AE':'[Shift] [Ã·]',
  'C0':'(-)','C8':'[Frac]','C9':'[xâ–ª]','CA':'[Shift] [xâ–ª]',
  'D0':'[)]','D4':'[xâ»Â¹]','D5':'[xÂ²]','D6':'[Shift] [xÂ²]','D7':'[Shift] [Ans]','D8':'[Shift] [xâ»Â¹]',
  'D9':'[OPTN] [2] [1]','DA':'[OPTN] [2] [2]','DB':'[OPTN] [2] [3]',
  'DC':"[Â°''']",'DD':"[OPTN] [3] [Â°''']",'DE':'[OPTN] [3] [(-)]','DF':'[OPTN] [3] [9]',
  'E0':'[OPTN] [3] [8]','E1':'[OPTN] [3] [7]','E2':'[OPTN] [3] [6]',
  'E3':'[OPTN] [3] [1]','E4':'[OPTN] [3] [2]','E5':'[OPTN] [3] [3]','E6':'[OPTN] [3] [4]','E7':'[OPTN] [3] [5]'
};

const cong_thuc2 = {
  '01':'[Shift] [8] [1] [1]','02':'[Shift] [8] [1] [2]','03':'[Shift] [8] [1] [3]','04':'[Shift] [8] [1] [4]','05':'[Shift] [8] [1] [5]','06':'[Shift] [8] [1] [6]',
  '07':'[Shift] [8] [1] [1]','08':'[Shift] [8] [1] [1]','09':'[Shift] [8] [1] [1]','0A':'[Shift] [8] [1] [(-)]',
  '0B':'[Shift] [8] [2] [1]','0C':'[Shift] [8] [2] [2]','0D':'[Shift] [8] [3] [1]','0E':'[Shift] [8] [3] [2]','0F':'[Shift] [8] [3] [3]',
  '10':'[Shift] [8] [3] [4]','11':"[Shift] [8] [1] [Â°''']",'12':'[Shift] [8] [1] [xâ»Â¹]',
  '13':'[Shift] [8] [â†“] [1] [2]','14':'[Shift] [8] [â†“] [1] [1]',
  '15':'[Shift] [8] [4] [1]','16':'[Shift] [8] [4] [2]','17':'[Shift] [8] [4] [3]','18':'[Shift] [8] [4] [4]',
  '19':'[Shift] [8] [â†“] [2] [1]','1A':'[Shift] [8] [â†“] [2] [2]','1B':'[Shift] [8] [â†“] [2] [3]','1C':'[Shift] [8] [â†“] [2] [4]',
  '1D':'[Shift] [8] [â†“] [4] [1]','1E':'[Shift] [8] [â†“] [4] [2]',
  '1F':'[Shift] [8] [â†“] [2] [5]','20':'[Shift] [8] [â†“] [2] [6]',
  '21':'[Shift] [8] [â†“] [3] [1]','22':'[Shift] [8] [â†“] [3] [2]',
  '23':'[Shift] [8] [â†“] [2] [7]','24':'[Shift] [8] [â†“] [2] [8]',
  '25':'[Shift] [8] [â†‘] [1] [2]','26':'[Shift] [8] [â†‘] [1] [1]',
  '27':'[Shift] [8] [â†“] [3] [4]','28':'[Shift] [8] [â†“] [3] [3]',

  '30':'[Shift] [7] [3] [1]','31':'[Shift] [7] [3] [2]','32':'[Shift] [7] [3] [3]','33':'[Shift] [7] [3] [4]','34':'[Shift] [7] [3] [5]',
  '35':'[Shift] [7] [1] [1]','36':'[Shift] [7] [2] [1]','37':'[Shift] [7] [2] [2]','38':'[Shift] [7] [1] [2]',
  '39':'[Shift] [7] [3] [6]','3A':'[Shift] [7] [3] [7]','3B':'[Shift] [7] [3] [8]','3C':'[Shift] [7] [3] [9]',
  '3D':'[Shift] [7] [3] [(-)]','3E':"[Shift] [7] [3] [Â°''']",'3F':'[Shift] [7] [3] [xâ»Â¹]',
  '40':'[Shift] [7] [4] [1]','41':'[Shift] [7] [3] [sin]','42':'[Shift] [7] [3] [cos]','43':'[Shift] [7] [3] [tan]',
  '44':'[Shift] [7] [3] [M+]','45':'[Shift] [7] [4] [2]','46':'[Shift] [7] [2] [3]',
  '47':'[Shift] [7] [4] [3]','48':'[Shift] [7] [4] [4]','49':'[Shift] [7] [4] [5]',
  '4A':'[Shift] [7] [4] [6]','4B':'[Shift] [7] [1] [3]','4C':'[Shift] [7] [4] [7]','4D':'[Shift] [7] [4] [8]','4E':'[Shift] [7] [4] [9]',
  '4F':'[Shift] [7] [1] [4]','50':'[Shift] [7] [1] [5]','51':'[Shift] [7] [2] [4]','52':'[Shift] [7] [â†“] [1] [1]',
  '53':'[Shift] [7] [2] [5]','54':'[Shift] [7] [1] [6]','55':'[Shift] [7] [â†“] [2] [1]',
  '56':'[Shift] [7] [1] [7]','57':'[Shift] [7] [â†“] [1] [2]','58':'[Shift] [7] [1] [8]','59':'[Shift] [7] [1] [9]',
  '5A':'[Shift] [7] [2] [6]','5B':'[Shift] [7] [2] [7]','5C':'[Shift] [7] [3] [x]',
  '5D':'[Shift] [7] [â†“] [1] [3]','5E':'[Shift] [7] [â†“] [1] [4]'
};

/* ==============================
   Reverse maps
   ============================== */

function reverseMap(obj){
  const rev = {};
  for(const k in obj){
    const v = obj[k];
    // náº¿u value trÃ¹ng nhau, cÃ¡i sau sáº½ overwrite (y chang python)
    // nhÆ°ng á»Ÿ Ä‘Ã¢y váº«n ok, vÃ¬ reverse chá»‰ dÃ¹ng cho char hiáº¿m khi trÃ¹ng.
    rev[v] = k;
  }
  return rev;
}

const reverse_hex_token = reverseMap(hex_token);
const reverse_hex_char = reverseMap(hex_char);

/* ==============================
   Helpers (Ä‘Ã£ nÃ¢ng cáº¥p so vá»›i python)
   ============================== */

function normalizeInput(s){
  return (s ?? "").trim().replace(/\s+/g, " ");
}

// TÃ¡ch input:
// - Náº¿u lÃ  hex cÃ³ space -> split
// - Náº¿u lÃ  hex liá»n -> tá»± cáº¯t theo 2/4
// - Náº¿u lÃ  char -> tÃ¡ch tá»«ng kÃ½ tá»±
function splitInput(input){
  const raw = normalizeInput(input);
  if(!raw) return [];

  // Náº¿u cÃ³ space vÃ  táº¥t cáº£ token Ä‘á»u hex
  if(raw.includes(" ")){
    const parts = raw.toUpperCase().split(" ").filter(Boolean);
    const ok = parts.every(p => /^[0-9A-F]+$/.test(p));
    if(ok) return parts;
  }

  // Náº¿u khÃ´ng cÃ³ space: check náº¿u toÃ n hex
  const upper = raw.toUpperCase();
  const onlyHex = /^[0-9A-F]+$/.test(upper);

  if(onlyHex){
    // Æ°u tiÃªn parse theo pattern:
    // - F4 + 2 hex
    // - FD + 2 hex
    // - cÃ²n láº¡i 2 hex
    const parts = [];
    let i = 0;
    while(i < upper.length){
      const remain = upper.length - i;

      // F4xx
      if(remain >= 4 && upper.slice(i, i+2) === "F4"){
        parts.push(upper.slice(i, i+4));
        i += 4;
        continue;
      }

      // FDxx
      if(remain >= 4 && upper.slice(i, i+2) === "FD"){
        parts.push(upper.slice(i, i+4));
        i += 4;
        continue;
      }

      // default 2
      if(remain >= 2){
        parts.push(upper.slice(i, i+2));
        i += 2;
        continue;
      }

      // láº» 1 kÃ½ tá»± -> Ä‘áº©y luÃ´n
      parts.push(upper.slice(i));
      break;
    }
    return parts;
  }

  // Char mode: tÃ¡ch tá»«ng kÃ½ tá»±
  return Array.from(raw);
}

// Merge kiá»ƒu python: náº¿u input dáº¡ng ["F4","7B"] -> ["F47B"]
function mergeHexParts(parts){
  const merged = [];
  let i = 0;
  while(i < parts.length){
    const p = (parts[i] || "").toUpperCase();

    // ghÃ©p F4 xx
    if(p === "F4" && i < parts.length - 1){
      merged.push("F4" + (parts[i+1] || "").toUpperCase());
      i += 2;
      continue;
    }

    // ghÃ©p FD xx
    if(p === "FD" && i < parts.length - 1){
      merged.push("FD" + (parts[i+1] || "").toUpperCase());
      i += 2;
      continue;
    }

    merged.push(p);
    i += 1;
  }
  return merged;
}

function toHexListFromInput(userInput){
  const parts = splitInput(userInput);

  // CHá»ˆ merge khi input lÃ  hex (vÃ¬ mergeHexParts upper-case)
  const isHexParts = parts.length > 0 && parts.every(p => /^[0-9A-Fa-f]+$/.test(p));

  const merged = isHexParts ? mergeHexParts(parts) : parts;

  const hexList = merged.map(part => {
    // 1) Náº¿u lÃ  char -> tra reverse char trÆ°á»›c (KHÃ”NG upper-case)
    const fromChar = reverse_hex_char[part];
    if(fromChar) return fromChar.toUpperCase();

    // 2) Náº¿u lÃ  token -> tra token (token cÃ³ thá»ƒ lÃ  "Ans", "ğ’™", ...)
    const fromToken = reverse_hex_token[part];
    if(fromToken) return fromToken.toUpperCase();

    // 3) Náº¿u lÃ  hex -> upper-case Ä‘á»ƒ chuáº©n hoÃ¡
    if(/^[0-9A-Fa-f]+$/.test(part)) return part.toUpperCase();

    // 4) fallback
    return String(part);
  });

  return hexList;
}


function computeHexCanGan(hexList){
  // â€œcáº§n gÃ¡nâ€ = khÃ´ng cÃ³ trong cong_thuc1 vÃ  khÃ´ng pháº£i space
  // (giá»¯ logic y há»‡t python cá»§a m)
  return hexList.filter(h => !(h in cong_thuc1) && h !== "20");
}

/* ==============================
   UI Actions
   ============================== */

const elMode = document.getElementById("mode");
const elInput = document.getElementById("input");
const elOut = document.getElementById("output");
const elStatus = document.getElementById("status");

const elTableWrap = document.getElementById("tableWrap");
const elTableHint = document.getElementById("tableHint");
const elTbody = document.getElementById("tbody");

function setStatus(msg, type="ok"){
  elStatus.textContent = msg;
  elStatus.className = "pill " + (type === "bad" ? "bad" : "ok");
}

function renderTextOutput(lines){
  elOut.textContent = lines.join("\n");
}

function renderTable(hexCodes){
  elTbody.innerHTML = "";

  const sorted = Array.from(hexCodes).sort((a,b)=>{
    // sort theo Ä‘á»™ dÃ i rá»“i theo string
    if(a.length !== b.length) return a.length - b.length;
    return a.localeCompare(b);
  });

  for(const hexCode of sorted){
    const tr = document.createElement("tr");

    const char = hex_char[hexCode] ?? "?";
    const token = hex_token[hexCode] ?? "?";
    const f1 = cong_thuc1[hexCode] ?? "KhÃ´ng cÃ³";
    const f2 = cong_thuc2[hexCode] ?? "KhÃ´ng cÃ³";

    tr.innerHTML = `
      <td>${escapeHtml(hexCode)}</td>
      <td>${escapeHtml(char)}</td>
      <td>${escapeHtml(token)}</td>
      <td>${escapeHtml(f1)}</td>
      <td>${escapeHtml(f2)}</td>
    `;
    elTbody.appendChild(tr);
  }
}

function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function run(){
  const mode = elMode.value;
  const userInput = normalizeInput(elInput.value);

  if(!userInput){
    setStatus("Nháº­p gÃ¬ Ä‘Ã³ Ä‘i ğŸ˜­", "bad");
    renderTextOutput(["(trá»‘ng)"]);
    elTableWrap.style.display = "none";
    elTableHint.style.display = "block";
    return;
  }

  try{
    if(mode === "4"){
      // Báº£ng kÃ½ tá»±: xá»­ lÃ½ giá»‘ng python nhÆ°ng sá»­a logic há»£p web hÆ¡n
      const parts = splitInput(userInput);
      const merged = mergeHexParts(parts);

      const hexCodes = new Set();

      // Náº¿u input lÃ  hex trá»±c tiáº¿p (vd F47B)
      if(merged.length === 1 && /^[0-9A-F]{2,4}$/.test(merged[0])){
        const hx = merged[0].toUpperCase();
        if(hx in hex_char || hx in hex_token) hexCodes.add(hx);
      }else{
        // Náº¿u input lÃ  chuá»—i kÃ½ tá»± -> láº¥y unique char
        const seen = new Set();
        const chars = Array.from(userInput);
        for(const ch of chars){
          if(seen.has(ch)) continue;
          seen.add(ch);

          const hx = reverse_hex_char[ch];
          if(hx) hexCodes.add(hx.toUpperCase());
        }
      }

      if(hexCodes.size === 0){
        setStatus("KhÃ´ng tÃ¬m tháº¥y mÃ£ nÃ o ğŸ˜¿", "bad");
        renderTextOutput([
          "ğŸ“œ **Báº¢NG KÃ Tá»° TRA Cá»¨U** ğŸ“œ",
          "KhÃ´ng tÃ¬m tháº¥y kÃ½ tá»±/hex há»£p lá»‡ trong input."
        ]);
        elTableWrap.style.display = "none";
        elTableHint.style.display = "block";
        return;
      }

      setStatus("ÄÃ£ táº¡o báº£ng âœ…", "ok");
      renderTextOutput([
        "ğŸ“œ **Báº¢NG KÃ Tá»° TRA Cá»¨U** ğŸ“œ",
        `TÃ¬m tháº¥y: ${hexCodes.size} mÃ£`
      ]);

      elTableWrap.style.display = "block";
      elTableHint.style.display = "none";
      renderTable(hexCodes);
      return;
    }

    // mode 1/2/3
    const hexList = toHexListFromInput(userInput);
    const hexCanGan = computeHexCanGan(hexList);

    if(mode === "1"){
      const charList = hexList.map(h => hex_char[h] ?? "?");
      setStatus("Done âœ…", "ok");
      renderTextOutput([
        "ğŸ” Káº¿t quáº£:",
        `- MÃ£ Hex: ${hexList.join(" ")}`,
        `- KÃ½ tá»± Char: ${charList.join("")}`,
        hexCanGan.length ? `- Hex cáº§n gÃ¡n: ${hexCanGan.join(" ")}` : ""
      ].filter(Boolean));
      saveHistory(`Mode ${mode}
      Input: ${userInput}
      Hex: ${hexList.join(" ")}`);

      elTableWrap.style.display = "none";
      elTableHint.style.display = "block";
      return;
    }

    if(mode === "2"){
      const tokenList = hexList.map(h => hex_token[h] ?? "?");
      setStatus("Done âœ…", "ok");
      renderTextOutput([
        "ğŸ” Káº¿t quáº£:",
        `- MÃ£ Hex: ${hexList.join(" ")}`,
        `- Token: ${tokenList.join(" ")}`,
        hexCanGan.length ? `- Hex cáº§n gÃ¡n: ${hexCanGan.join(" ")}` : ""
      ].filter(Boolean));
      saveHistory(`Mode ${mode}
      Input: ${userInput}
      Hex: ${hexList.join(" ")}`);

      elTableWrap.style.display = "none";
      elTableHint.style.display = "block";
      return;
    }

    if(mode === "3"){
      const charList = hexList.map(h => hex_char[h] ?? "?");
      const tokenList = hexList.map(h => hex_token[h] ?? "?");
      setStatus("Done âœ…", "ok");
      renderTextOutput([
        "ğŸ” Káº¿t quáº£:",
        `- MÃ£ Hex: ${hexList.join(" ")}`,
        `- KÃ½ tá»± Char: ${charList.join("")}`,
        `- Token: ${tokenList.join(" ")}`,
        hexCanGan.length ? `- Hex cáº§n gÃ¡n: ${hexCanGan.join(" ")}` : ""
      ].filter(Boolean));
      saveHistory(`Mode ${mode}
      Input: ${userInput}
      Hex: ${hexList.join(" ")}`);

      elTableWrap.style.display = "none";
      elTableHint.style.display = "block";
      return;
    }

  }catch(err){
    setStatus("Lá»—i rá»“i ğŸ’€", "bad");
    renderTextOutput([
      "âŒ CÃ³ lá»—i xáº£y ra:",
      String(err)
    ]);
    elTableWrap.style.display = "none";
    elTableHint.style.display = "block";
  }
}

/* ==============================
   Optional - Collapsible
============================== */

const optionalToggle = document.getElementById("optionalToggle");
const optionalContent = document.getElementById("optionalContent");
const historyList = document.getElementById("historyList");
const clearHistoryBtn = document.getElementById("clearHistory");

optionalToggle.addEventListener("click", () => {
  optionalContent.classList.toggle("open");

  optionalToggle.innerHTML = optionalContent.classList.contains("open")
    ? "â–¼ Optional"
    : "â–¶ Optional";
});

/* ==============================
   History System
============================== */

function loadHistory(){
  const data = JSON.parse(localStorage.getItem("hex_history") || "[]");
  if(data.length === 0){
    historyList.textContent = "(ChÆ°a cÃ³ lá»‹ch sá»­)";
    return;
  }

  historyList.textContent = data.join("\n\n");
}

function saveHistory(entry){
  let data = JSON.parse(localStorage.getItem("hex_history") || "[]");

  data.unshift(entry); // thÃªm lÃªn Ä‘áº§u

  if(data.length > 20) data.pop(); // giá»›i háº¡n 20 dÃ²ng

  localStorage.setItem("hex_history", JSON.stringify(data));
  loadHistory();
}

clearHistoryBtn.addEventListener("click", () => {
  localStorage.removeItem("hex_history");
  loadHistory();
});

loadHistory();

document.getElementById("btnRun").addEventListener("click", run);

document.getElementById("btnClear").addEventListener("click", ()=>{
  elInput.value = "";
  renderTextOutput(["..."]);
  setStatus("Ready", "ok");
  elTableWrap.style.display = "none";
  elTableHint.style.display = "block";
});

document.getElementById("btnCopy").addEventListener("click", async ()=>{
  try{
    await navigator.clipboard.writeText(elOut.textContent || "");
    setStatus("ÄÃ£ copy ğŸ“‹", "ok");
  }catch(e){
    setStatus("Copy fail (browser cháº·n) ğŸ˜­", "bad");
  }
});

// auto run khi Ä‘á»•i mode
elMode.addEventListener("change", ()=>{
  const mode = elMode.value;
  if(mode === "4"){
    elTableHint.textContent = "Nháº­p kÃ½ tá»± hoáº·c hex Ä‘á»ƒ xem báº£ng.";
  }else{
    elTableHint.textContent = "Mode 4 sáº½ show báº£ng á»Ÿ Ä‘Ã¢y.";
  }
  run();
});

// run láº§n Ä‘áº§u
setStatus("Ready", "ok");
renderTextOutput(["..."]);
</script>
</body>
</html>
