<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>M3U8 Player - Debug Mode</title>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        body {
            background-color: #0f0f0f;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        h1 {
            margin-bottom: 15px;
        }

        input[type="text"] {
            width: 80%;
            max-width: 700px;
            padding: 10px;
            border-radius: 8px;
            border: none;
            margin-bottom: 10px;
        }

        button {
            padding: 8px 16px;
            margin: 5px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        video {
            width: 90%;
            max-width: 900px;
            margin-top: 20px;
            background: black;
            border-radius: 10px;
        }

        .status {
            margin-top: 10px;
            font-weight: bold;
        }

        .log {
            text-align: left;
            background: #1b1b1b;
            padding: 10px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 13px;
            border-radius: 8px;
        }

        .error { color: #ff4c4c; }
        .success { color: #00ff88; }
        .info { color: #00c8ff; }
    </style>
</head>
<body>

<h1>ðŸŽ¬ M3U8 Player (Debug Mode)</h1>

<input type="text" id="m3u8Input" placeholder="DÃ¡n link .m3u8 vÃ o Ä‘Ã¢y...">

<br>

<button onclick="loadVideo()">PhÃ¡t</button>
<button onclick="toggleProxy()">Báº­t/Táº¯t Proxy</button>
<button onclick="clearLog()">XoÃ¡ Log</button>

<video id="videoPlayer" controls></video>

<div id="status" class="status"></div>
<div id="logBox" class="log"></div>

<script>
    const video = document.getElementById("videoPlayer");
    const statusText = document.getElementById("status");
    const logBox = document.getElementById("logBox");
    const input = document.getElementById("m3u8Input");

    let hls;
    let useProxy = false;

    const proxyURL = "https://corsproxy.io/?";

    function log(message, type = "info") {
        const line = document.createElement("div");
        line.className = type;
        line.textContent = "[" + new Date().toLocaleTimeString() + "] " + message;
        logBox.appendChild(line);
        logBox.scrollTop = logBox.scrollHeight;
        console.log(message);
    }

    function clearLog() {
        logBox.innerHTML = "";
    }

    function toggleProxy() {
        useProxy = !useProxy;
        log("Proxy: " + (useProxy ? "ON" : "OFF"), "info");
    }

    function loadVideo() {

        const rawURL = input.value.trim();
        if (!rawURL) {
            statusText.textContent = "ChÆ°a nháº­p link!";
            statusText.className = "status error";
            return;
        }

        let finalURL = rawURL;
        if (useProxy) {
            finalURL = proxyURL + rawURL;
        }

        log("Loading: " + finalURL, "info");

        if (hls) {
            hls.destroy();
        }

        if (Hls.isSupported()) {

            hls = new Hls({
                debug: false,
                enableWorker: true,
                lowLatencyMode: true
            });

            hls.loadSource(finalURL);
            hls.attachMedia(video);

            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                statusText.textContent = "Manifest loaded âœ”";
                statusText.className = "status success";
                log("Manifest parsed successfully", "success");
                video.play();
            });

            hls.on(Hls.Events.ERROR, function(event, data) {

                log("Error Type: " + data.type, "error");
                log("Error Details: " + data.details, "error");
                log("Fatal: " + data.fatal, "error");

                if (data.fatal) {

                    switch(data.type) {

                        case Hls.ErrorTypes.NETWORK_ERROR:
                            log("Trying to recover network error...", "info");
                            hls.startLoad();
                            break;

                        case Hls.ErrorTypes.MEDIA_ERROR:
                            log("Trying to recover media error...", "info");
                            hls.recoverMediaError();
                            break;

                        default:
                            log("Destroying HLS instance", "error");
                            hls.destroy();
                            break;
                    }
                }
            });

        } else if (video.canPlayType("application/vnd.apple.mpegurl")) {

            video.src = finalURL;
            video.addEventListener("loadedmetadata", function() {
                statusText.textContent = "Loaded via native HLS âœ”";
                statusText.className = "status success";
                video.play();
            });

        } else {

            statusText.textContent = "Browser khÃ´ng há»— trá»£ HLS.";
            statusText.className = "status error";
        }
    }

    input.addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            loadVideo();
        }
    });

</script>

</body>
</html>
